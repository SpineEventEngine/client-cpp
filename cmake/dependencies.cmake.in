cmake_minimum_required(VERSION 3.5.1)

include(ExternalProject)

set(CMAKE_BINARY_DIR @CMAKE_BINARY_DIR@)

ExternalProject_Add(spine_proto_dependency
        URL https://spine.mycloudrepo.io/public/repositories/releases/io/spine/spine-client/1.0.0-pre6/spine-client-1.0.0-pre6-proto.jar
        CONFIGURE_COMMAND ""
        BUILD_COMMAND ""
        INSTALL_COMMAND ""
        #EXCLUDE_FROM_ALL 1
        SOURCE_DIR @SPINE_DEPENDENCIES_DIR@
        )

    execute_process(COMMAND curl -s https://api.github.com/repos/grpc/grpc/releases/latest
            COMMAND grep tag_name
            OUTPUT_VARIABLE GRPC_TAG_STRING)
    string(REGEX REPLACE ".*\"([^\"]+)\".*" "\\1" GRPC_TAG ${GRPC_TAG_STRING})

ExternalProject_Add(grpc_dependency
     PREFIX @GRPC_PREFIX_DIR@
     SOURCE_DIR @GRPC_DEPENDENCIES_DIR@
     UPDATE_COMMAND ""
     GIT_REPOSITORY "https://github.com/grpc/grpc.git"
     GIT_TAG "${GRPC_TAG}"
     GIT_SUBMODULES
     GIT_SHALLOW 1
     CONFIGURE_COMMAND ""
     BUILD_COMMAND make HAS_SYSTEM_PROTOBUF=false
     INSTALL_COMMAND ""
     #EXCLUDE_FROM_ALL 1
     BUILD_IN_SOURCE 1
     TLS_VERIFY false
     )

#Protobuf
ExternalProject_Add(gtest_dependency
        DEPENDS grpc_dependency
        DOWNLOAD_COMMAND ""
        SOURCE_DIR @GTEST_DEPENDENCIES_DIR@
        INSTALL_COMMAND ""
        BUILD_IN_SOURCE 1
        )
